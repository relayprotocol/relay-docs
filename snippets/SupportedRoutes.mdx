export const SupportedRoutes = ({ id }) => {
  const key = 'supported-routes-data';

if (typeof window === "undefined") {
return null;
}
if (typeof document === "undefined") {
return null;
}

if (!window[key]) {
window[key] = {
fetching: false,
data: null,
observer: null
};
}

if (!window[key].fetching) {
const showLoading = () => {
const rootElement = document.getElementById(id);
if (!rootElement) {
return;
}
rootElement.innerHTML = `<tr><td colspan="4" style="text-align: center; padding: 20px;">Loading...</td></tr>`;
};

const appendRoutes = (data) => {
const rootElement = document.getElementById(id);
if (!rootElement) {
return;
}

const priorityChains = ['Ethereum', 'Base', 'Arbitrum', 'Optimism', 'BNB', 'Polygon', 'Solana'];

const rows = data
.slice()
.sort((a, b) => {
const aIndex = priorityChains.indexOf(a.displayName);
const bIndex = priorityChains.indexOf(b.displayName);

if (aIndex !== -1 && bIndex !== -1) {
return aIndex - bIndex;
}
if (aIndex !== -1) return -1;
if (bIndex !== -1) return 1;

return a.displayName.localeCompare(b.displayName);
})
.map((chain) => {
const solverCurrencies = chain.solverCurrencies 
? chain.solverCurrencies
.slice()
.sort((a, b) => {
const priority = ['ETH', 'USDC', 'USDT'];
const aIndex = priority.indexOf(a.symbol);
const bIndex = priority.indexOf(b.symbol);

if (aIndex !== -1 && bIndex !== -1) {
return aIndex - bIndex;
}
if (aIndex !== -1) return -1;
if (bIndex !== -1) return 1;

return 0;
})
.map(c => c.symbol)
.join(', ')
: '';

const swapsSupported = chain.tokenSupport === 'All' ? 'true' : 'false';

const gasTopUpSupported = 
chain.vmType === 'evm' && (
chain.tokenSupport === "All" || 
(chain.currency && chain.currency.supportsBridging === true)
);

return `<tr key=${chain.id}>
          <td>${chain.displayName}</td>
          <td>${solverCurrencies}</td>
          <td>${swapsSupported}</td>
          <td>${gasTopUpSupported ? 'true' : 'false'}</td>
        </tr>`;
});

rootElement.innerHTML = `<div id="${id}-marker"></div>${rows.join("")}`;
if (!window[key].observer) {
let observer = new MutationObserver(function(mutations) {
if (!document.getElementById(`${id}-marker`)) {
appendRoutes(data)
}
});
observer.observe(document.body, {childList: true, subtree: true});
window[key].observer = observer
}
};

const fetchChains = async () => {
try {
if (window[key].fetching) return;
window[key].fetching = true;
window[key].data = null;
showLoading();
const response = await fetch("https://api.relay.link/chains");
const data = await response.json();
window[key].fetching = false;
window[key].data = data.chains;
appendRoutes(data.chains);
} catch (e) {
console.error('Error fetching chains:', e);
window[key].fetching = false;
window[key].data = false;
}
};

if (window[key].data) {
appendRoutes(window[key].data);
} else {
showLoading();
fetchChains();
}

}

return (
<table
style={{ width: "100%" }}
className="relay-table" >
<thead
style={{
          borderBottom: "1px solid rgb(227 226 230)",
          paddingBottom: 5,
          width: "100%",
          fontSize: 16,
        }} >
<tr style={{ textAlign: "left" }}>
<th>Chain Name</th>
<th>Solver Currencies (supported natively)</th>
<th>Swaps Supported</th>
<th>Gas Top Up Supported</th>
</tr>
</thead>
<tbody id={id}></tbody>
</table>
);
};

